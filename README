
README
=====

The perf test class is perf.Test, use run.sh to run it. 



Setup
-----

- Use the httpd.conf below:
# MOD_CLUSTER_ADDS
# Adjust to your hostname and subnet.

ServerLimit 20
ThreadsPerChild 50
StartServers 10
MaxClients 500

<IfModule manager_module>
  Listen 8000
  ManagerBalancerName mycluster
  Maxcontext 100
  Maxnode 40
  Maxhost 40
  Maxsessionid 400
  ReduceDisplay off
  <VirtualHost *:8000>
    <Location />
     Order deny,allow
     Allow from all
    </Location>

    KeepAliveTimeout 20
    MaxKeepAliveRequests 0
    ServerAdvertise off
    AdvertiseFrequency 30
    #AdvertiseSecurityKey secret
    #AdvertiseGroup @ADVIP@:23364
    EnableMCPMReceive

    <Location /mod_cluster_manager>
       SetHandler mod_cluster-manager
       Order deny,allow
       Allow from all
    </Location>

  </VirtualHost>
</IfModule>



- Use the run-master.sh script below to start a JBoss 7 domain controller:
  ./run-master.sh

- Use the run-slave.sh script to start N slave host controllers:
  ./run-slave.sh 2 // name ('2') needs to be unique for every slave


- Modify domain.xml:

  * Parameterize instance-id in jboss:domain:web:1.1:
    <subsystem xmlns="urn:jboss:domain:web:1.1" default-virtual-server="default-host" instance-id="${jboss.node.name:undefined}" native="false">
  
 
  * modcluster:
    <subsystem xmlns="urn:jboss:domain:modcluster:1.0">
         <mod-cluster-config advertise-socket="modcluster" 
                         proxy-list="192.168.1.5:8000,192.168.1.10:8000" 
                         advertise="false"/>
    </subsystem>


  Make sure to adjust proxy-list.

  * Change the AJP connector:
    <connector name="ajp" protocol="AJP/1.3" 
               scheme="ajp" socket-binding="ajp" 
               max-connections="410"/>

  * Change <interfaces>:
    <interfaces>
        <interface name="management">
            <inet-address value="${jboss.bind.address.management:127.0.0.1}"/>
        </interface>
        <interface name="public">
            <inet-address value="${jboss.bind.address:127.0.0.1}"/>
        </interface>
        <interface name="unsecure">
            <inet-address value="${jboss.bind.address.unsecure:127.0.0.1}"/>
        </interface>
    </interfaces>

     --> Remove "unsecure"
     --> Change jboss.bind.address.management to jboss.bind.address


- Further modifications:
  * JGroups and Infinispan configs in standalone-ha.xml
  * Update JGroups and Infinispan versions to 3.1 and 5.2 (possibly snapshots)
